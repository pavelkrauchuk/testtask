# Test Task Web Application
### Комментарий
Для работы приложения требуется установить при помощи **Composer** 
зависимости из файла ``сomposer.lock`` и сформировать автозагрузчик 
классов.

Для хранения данных использовалась СУБД MariaDB v.10.5.11, перед запуском приложения 
необходимо развернуть дамп базы данных из файла `testtask.sql`. 
Настройка DSN-строки для подключения к БД осуществляется в файле 
`src/Database.php`:
```php
/** @var string DSN-строка для подключения к БД */
private static string $dsn = 'mysql:dbname=testtask;host=127.0.0.1';
```
Там же указываются логин и пароль пользователя БД (так как тестирование 
проводилось на локальной машине, то оставлен дефолтный для Open Server root без пароля):
```php
/** @var string Имя пользователя БД */
private static string $user = 'root';

/** @var string Пароль пользователя БД */
private static string $password = '';
```
Количество денег, доступное в приложении для генерирования денежных 
призов можно указать как параметр в таблице БД `settings`:

| param           | value |
|-----------------|-------|
| available_money | 2205  |

Доступные для использования при генерации призов предметы хранятся в 
таблице БД ``available_things``. Выбранный случайным образом предмет 
удаляется из таблицы. В случае, если пользователь в последствии отказывается от 
приза-предмета после его получения, запись о предмете снова помещается 
в таблицу доступных предметов и он может быть использован при генерации 
последующих призов.

При генерации денежных призов пропорционально уменьшается значение 
параметра ``available_money`` указанной выше таблицы, при отказе 
пользователя от денежного приза, сумма возвращается к доступным 
средствам.

В таблице ``users`` уже имеется запись о пользователе, для авторизации в 
приложении можно использовать следующие данные:
- логин: ``lucky``
- пароль: ``12345``

Для перечисления денежного приза на счет пользователя в банке 
осуществляется HTTP-запрос по адресу [http://test/api.php](http://test/api.php),
данные о призе отправляются в формате JSON (метод ``transferToBank()`` 
класса ``src/Controller/MoneyPrizeController.php``). Для возможности 
преобразования объекта в JSON, класс ``src/Entity/MoneyPrize.php`` 
реализует метод ``jsonSerialize()`` интерфейса ``JsonSerializable``. 
Отправляемые данные имеют следующую структуру:
```json
{"id":266,"type":"money","amount":210}
```

Консольная команда для пакетной отправки в банк данных о всех ранее не 
отправленных денежных призах пользователей принимает два обязательных 
параметра: ``transfer`` (название операции) и количество передаваемых 
призов в одном HTTP-запросе. Данные отправляются также в формате JSON по 
указанному выше адресу. Пример вызова консольной команды из корневой 
директории проекта:
```shell
php bin/cli.php transfer 10
```
Для написания модульных тестов использовался PHPUnit, класс теста находится в файле ``tests/Helper/MoneyHelperTest.php``.
